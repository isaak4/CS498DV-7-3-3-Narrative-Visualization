<!DOCTYPE html>
<html lang="en">
<header>
    <title>Europe's innovation in numbers</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
      svg {
        width:400px;
        height:400px;        
      }
      /* #tooltip {
        position: absolute;
        text-align: center;
        width: 60px; height: 40px;
        background: red;
        border: 0px;
        visibility: hidden;
      }       */
    </style>
</header>
<body onload="init()">
    <script type="text/javascript">
      var mydata;
      var max_hrst=0, max_patents_per_mi=0, max_gov_edu_exp=0, max_gerd=0;
      var min_hrst=0, min_patents_per_mi=0, min_gov_edu_exp=0, min_gerd=0;
      
      async function init() {
          await d3.csv("https://raw.githubusercontent.com/isaak4/CS498DV-7-3-3-Narrative-Visualization/master/EU28_innov.csv")
          .then(function(d) { mydata = d;});
          // variables: Country, Year, hrst, patents_per_mi, gov_edu_exp, gerd
          var svg1 = d3.select("#chart1"), svg2 = d3.select("#chart2"), svg3 = d3.select("#chart3")
          var tooltip = d3.select("#cchart1")
                          .append("div")
                          .style("position", "absolute")
                          .style("visibility", "hidden")
                          .style("width", "100px")
                          .style("height", "40px")
                          .style("background", "white")
                          .style("border", "0px")
                          .style("z-index", "100")
                          .text("I'm a circle!");
          // console.log(tooltip)
          max_hrst = getMax(mydata, "hrst")
          max_patents_per_mi = getMax(mydata, "patents_per_mi")
          max_gov_edu_exp = getMax(mydata, "gov_edu_exp")
          max_gerd = getMax(mydata, "gerd")
          min_hrst = getMin(mydata, "hrst")
          min_patents_per_mi = getMin(mydata, "patents_per_mi")
          min_gov_edu_exp = getMin(mydata, "gov_edu_exp")
          min_gerd = getMin(mydata, "gerd")
          // console.log(mydata)
          // console.log(max_gerd)
          // Create axes
          var ys = d3.scaleLinear()
                  .domain([min_patents_per_mi, max_patents_per_mi])
                  .range([350, 0]);
          var xs1 = d3.scaleLinear()
                  .domain([min_gerd, max_gerd])
                  .range([0, 350]);
          var xs2 = d3.scaleLinear()
                  .domain([min_gov_edu_exp, max_gov_edu_exp])
                  .range([0, 350]);
          var xs3 = d3.scaleLinear()
                  .domain([min_hrst, max_hrst])
                  .range([0, 350]);
          var yaxis = d3.axisLeft(ys);
          var xaxis1 = d3.axisBottom(xs1);
          var xaxis2 = d3.axisBottom(xs2);
          var xaxis3 = d3.axisBottom(xs3);

          svg1.append("g")
              .attr("transform", "translate(25,25)")
              .call(yaxis);
          svg1.append("g")
              .attr("transform", "translate(25,375)")
              .call(xaxis1);
          svg1.append("g")
              .attr("transform", "translate(25,25)")
              .selectAll('circle').data(mydata).enter().append('circle')
              .attr("cx", function(d) {return xs1(d.gerd);})
              .attr("cy", function(d) {return ys(d.patents_per_mi);})
              .attr("r", "5")
              .attr("stroke", function(d,i) {return d3.color("blue");})
              .attr("fill", function(d,i) {return d3.color("cyan");})
              .attr("html", function(d) {return d.Country;})
              .on("mouseover", function(){return tooltip.style("visibility", "visible");})
              .on("mousemove", function(d){tooltip.style("top", (d3.event.pageY-300)+"px").style("left",(d3.event.pageX)+"px").text(d.Country+d.Year); 
              })
              .on("mouseout", function(){return tooltip.style("visibility", "hidden");});
              // .on("mouseover", function(){return tooltip.style("visibility", "visible");})
              // .on("mousemove", function(){return tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");
              // console.log("mousemove")})
              // // .on("mouseover", function(d,i){
              // //   tooltip
              // //   // .style("opacity",1)
              // //   .style("left", (d3.event.pageX)+"px")
              // //   .style("top", (d3.event.pageY)+"px")
              // //   // .style("left", "0px")
              // //   // .style("top", "0px")
              // //   .html("Item #"+i+" is ");
              // // })
              // .on("mouseout", function(){return tooltip.style("visibility", "hidden");});
          svg2.append("g")
              .attr("transform", "translate(25,25)")
              .call(yaxis);
          svg2.append("g")
              .attr("transform", "translate(25,375)")
              .call(xaxis2);
          svg2.append("g")
              .attr("transform", "translate(25,25)")
              .selectAll('circle').data(mydata).enter().append('circle')
              .attr("cx", function(d) {return xs2(d.gov_edu_exp);})
              .attr("cy", function(d) {return ys(d.patents_per_mi);})
              .attr("r", "5")
              .attr("stroke", function(d,i) {return d3.color("blue");})
              .attr("fill", function(d,i) {return d3.color("cyan");})
              .attr("html", function(d) {return d.Country;})
              .on("mouseover", function(){return tooltip.style("visibility", "visible");})
              .on("mousemove", function(){return tooltip.style("top", (d3.event.pageY-300)+"px").style("left",(d3.event.pageX)+"px");})
              .on("mouseout", function(){return tooltip.style("visibility", "hidden");});

          svg3.append("g")
              .attr("transform", "translate(25,25)")
              .call(yaxis);
          svg3.append("g")
              .attr("transform", "translate(25,375)")
              .call(xaxis3);
          svg3.append("g")
              .attr("transform", "translate(25,25)")
              .selectAll('circle').data(mydata).enter().append('circle')
              .attr("cx", function(d) {return xs3(d.hrst);})
              .attr("cy", function(d) {return ys(d.patents_per_mi);})
              .attr("r", "5")
              .attr("stroke", function(d,i) {return d3.color("blue");})
              .attr("fill", function(d,i) {return d3.color("cyan");})
              .attr("html", function(d) {return d.Country;})
              .on("mouseover", function(){return tooltip.style("visibility", "visible");})
              .on("mousemove", function(){return tooltip.style("top", (event.pageY-300)+"px").style("left",(event.pageX)+"px");})
              .on("mouseout", function(){return tooltip.style("visibility", "hidden");});


      }
      
      function getMax(arr, field) {
        var max = -100000;
        var val = 0;
        arr.forEach(function(obj) {
          val = obj[field];
          if(val > max) {
            max = val;
          }
        });
        return max;
      }

      function getMin(arr, field) {
        var min = 100000;
        var val = 0;
        arr.forEach(function(obj) {
          val = obj[field];
          if(val < min) {
            min = val;
          }
        });
        return min;
      }

      function click_button() {
          var pie_data = [4,3,8,9];
          var pie = d3.pie();
          var arc = d3.arc().innerRadius(10).outerRadius(50).cornerRadius(5);
          var color = ["red", "green", "blue", "orange"]
          //var xs = d3.scaleLinear().doma
          d3.select("#chart2")
          //d3.select('svg')
          .append("g")
          .attr("transform","translate(50,50)")
          .selectAll("path")
          .data(pie(pie_data))
          .enter()
          .append("path")
          .attr("d", arc)
          .attr("fill", function(d,i) {return color[i];})
          .on("mouseover", function(d,i){
              tooltip.style("opacity",1)
              .style("left", (d3.event.pageX)+"px")
              .style("top", (d3.event.pageY)+"px")
              .html("Item #"+i+" is "+d.Value_in_euros);
          })
          .on("mouseout", function(d,i) { tooltip.style("opacity",0);});
          ;
      }
    </script>

    <div class="jumbotron text-center">
      <h1>Europe's innovation in numbers</h1>
      <p>What is the patent application output of each EU country in terms of the budget they spent on education, their total human resources in science and technology sectors and their gross domestic expenditure on R&D respectively?</p> 
    </div>
            
    <div class="container-fluid bg-3 text-center align-text-bottom">    
      <div class="row">
        <div class="col-lg-4" id="cchart1">
          <h3>Patent applications vs % of GDP spent on education.</h3>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
          <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
          <svg id="chart1" class="chart">
              <rect width="100%" height="100%" fill="orange"></rect>
          </svg>
        </div>
        <div class="col-lg-4">
          <h3>Patent applications vs % of GDP expenditure on R&D.</h3>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
          <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
          <svg id="chart2" class="chart">
              <rect width="100%" height="100%" fill="green"></rect>
          </svg>
        </div>
        <div class="col-lg-4">
          <h3>Patent applications vs Human Resources in Science and Technology roles.</h3>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
          <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
          <svg id="chart3" class="chart">
              <rect width="100%" height="100%" fill="brown"></rect>
          </svg>
        </div>
      </div>
      <div class="row">
          <button onclick="click_button()">Click me</button>
      </div>
    </div>

</body>
</html>
